# RIGHTARM v4-Simple 要件定義書・仕様書

## 📋 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [システム要件](#システム要件)
3. [機能要件](#機能要件)
4. [画面設計仕様](#画面設計仕様)
5. [データベース設計](#データベース設計)
6. [API仕様](#api仕様)
7. [技術仕様](#技術仕様)
8. [開発計画](#開発計画)
9. [運用・保守](#運用保守)

---

## プロジェクト概要

### プロジェクト名
**RIGHTARM v4-Simple** - 企業とCFOの最小限マッチングプラットフォーム

### プロジェクト目的
企業の財務課題とCFOの専門スキルをマッチングする**MVP（Minimum Viable Product）**を構築し、市場需要とユーザビリティを検証する。

### ビジネス目標
1. **需要検証**: 企業とCFOのマッチング需要の存在確認
2. **ユーザビリティ検証**: 基本的なユーザージャーニーの有効性確認
3. **ビジネスモデル検証**: 基本的なマッチング成立率の測定

### 対象ユーザー
- **企業**: 財務課題を抱える中小企業・スタートアップ（50社目標）
- **CFO**: 副業・複業で企業支援を行いたい財務専門家（50名目標）

### 成功指標（3ヶ月後）
- **登録ユーザー数**: 100名（企業50社 + CFO50名）
- **マッチング成立**: 月間20件
- **メッセージ交換率**: 50%以上
- **ユーザー継続率**: 30%以上

---

## システム要件

### 非機能要件

#### パフォーマンス要件
- **ページ読み込み時間**: 3秒以内
- **同時接続ユーザー数**: 100名
- **データベース応答時間**: 500ms以内
- **メッセージ送信遅延**: 2秒以内

#### 可用性要件
- **稼働率**: 99%以上
- **メンテナンス時間**: 月1回、最大2時間
- **バックアップ**: 日次自動バックアップ

#### セキュリティ要件
- **認証**: メールアドレス + パスワード
- **通信**: HTTPS暗号化
- **個人情報保護**: GDPR準拠
- **データ保持**: 法的要件に準拠

#### 互換性要件
- **ブラウザ**: Chrome, Safari, Firefox, Edge（最新2バージョン）
- **モバイル**: iOS 14+, Android 10+
- **画面解像度**: 320px〜1920px対応

---

## 機能要件

### 📱 実装対象機能

#### 1. ユーザー認証・管理
```
✅ 必須機能:
├── ユーザー登録（企業/CFO選択）
├── メール認証
├── ログイン・ログアウト
├── パスワードリセット
└── 基本プロフィール管理

❌ 実装しない:
├── SNSログイン
├── 二段階認証
├── アカウント削除
└── 詳細な権限管理
```

#### 2. プロフィール機能
```
✅ 企業プロフィール:
├── 会社名 *
├── 担当者名 *
├── メールアドレス *
├── 会社概要
├── 所在地（都道府県）
├── 抱えている財務課題（チェックボックス）
│   ├── 資金調達
│   ├── IPO準備
│   ├── M&A支援
│   ├── 管理会計
│   ├── 財務DX
│   └── 事業再生
└── 希望予算レンジ

✅ CFOプロフィール:
├── 氏名 *
├── メールアドレス *
├── 自己紹介
├── 居住地（都道府県）
├── 専門スキル（チェックボックス）
│   ├── 資金調達支援
│   ├── IPO・M&A関連
│   ├── 管理会計構築
│   ├── 財務DX・システム導入
│   ├── 事業再生・事業承継
│   └── 組織・ガバナンス関連
├── 経験年数
├── 希望報酬レンジ（月額）
└── 稼働形態（リモート可/出社必要）

❌ 実装しない:
├── プロフィール写真アップロード
├── 職歴・学歴詳細
├── 認証・バッジシステム
├── ポートフォリオ添付
└── 詳細な条件設定
```

#### 3. 検索・マッチング機能
```
✅ 基本検索機能:
├── キーワード検索（名前・会社名・スキル）
├── 地域フィルター（都道府県）
├── スキル分野フィルター
├── 予算・報酬レンジフィルター
└── 一覧表示（カード形式）

❌ 実装しない:
├── 高度な検索フィルター
├── 保存済み検索
├── AIレコメンデーション
├── お気に入り機能
└── 閲覧履歴
```

#### 4. メッセージング機能
```
✅ 基本メッセージング:
├── 1対1チャット
├── テキストメッセージ送受信
├── メッセージ履歴表示
├── 新着メッセージ通知（メール）
└── 会話一覧表示

❌ 実装しない:
├── ファイル・画像添付
├── 既読・未読表示
├── リアルタイム通知
├── メッセージ検索
├── グループチャット
└── 絵文字・リアクション
```

#### 5. レビュー・評価システム
```
✅ 基本評価機能:
├── 5段階評価（星評価）
├── コメント投稿
├── 評価・レビュー一覧表示
├── 平均評価の表示
└── 相互評価システム（企業↔CFO）

❌ 実装しない:
├── 詳細なスキル別評価
├── 匿名評価機能
├── 評価の重み付け
├── 評価に対するリアクション
└── 評価の統計分析
```

#### 6. 決済リンク・ステータス管理システム
```
✅ シンプル決済管理:
├── 決済リンク表示・共有機能
│   ├── 銀行振込先情報表示
│   ├── 決済リンク生成（外部サービス用）
│   ├── QRコード決済対応
│   └── 決済方法案内
├── 手動決済ステータス管理
│   ├── 未契約
│   ├── 契約済み
│   ├── 請求書送付済み
│   ├── 入金確認済み
│   ├── 完了
│   └── キャンセル
├── 管理画面からのステータス変更
├── ステータス履歴管理
├── メール通知（ステータス変更時）
└── 基本的な入金管理

❌ 実装しない:
├── 自動決済処理（Stripe等の複雑な統合）
├── クレジットカード決済
├── 自動請求・督促機能
├── 詳細な売上分析
└── 税務処理機能
```

#### 7. 基本ダッシュボード
```
✅ シンプルダッシュボード:
├── 検索結果一覧
├── 新着メッセージ表示
├── プロフィール完成度表示
├── 基本的な統計（受信・送信メッセージ数）
├── 最新の評価・レビュー表示
└── 決済ステータス概要

❌ 実装しない:
├── 詳細な分析・レポート
├── 活動履歴
├── 通知センター
├── 推奨アクション
└── パフォーマンス指標
```

### 🚫 実装対象外機能

#### v2以降に延期する機能
- スカウト・応募システム
- 面談予約・カレンダー機能
- 自動決済処理（Stripe等）
- 詳細な通知システム
- 高度な分析・レポート機能
- ファイル添付・共有機能
- AIマッチング機能
- モバイルアプリ

---

## 画面設計仕様

### 🌟 ランディングページ (`/`)

#### 画面構成
```
┌─────────────────────────────────────┐
│ [RIGHTARM]              [ログイン]   │
├─────────────────────────────────────┤
│                                   │
│           RIGHTARM                 │
│     企業とCFOをつなぐ                │
│      マッチングプラットフォーム        │
│                                   │
│ ┌─────────────────┬─────────────────┐ │
│ │ 企業の方           │ CFOの方          │ │
│ │                  │                 │ │
│ │ 財務課題を解決したい │ スキルを活かしたい │ │
│ │ 企業様向け         │ CFO様向け        │ │
│ │                  │                 │ │
│ │ [企業として登録]    │ [CFOとして登録]   │ │
│ └─────────────────┴─────────────────┘ │
│                                   │
│ [すでにアカウントをお持ちの方はこちら]  │
├─────────────────────────────────────┤
│ 利用規約 | プライバシーポリシー        │
│ © 2024 RightArm. All rights reserved.│
└─────────────────────────────────────┘
```

#### レスポンシブ対応
- **デスクトップ**: 2カラムレイアウト
- **モバイル**: 縦積みレイアウト
- **ブレークポイント**: 768px

---

### 🔐 会員登録ページ (`/auth/register`)

#### URL構造
- 企業登録: `/auth/register?type=company`
- CFO登録: `/auth/register?type=cfo`

#### 企業登録フォーム
```
┌─────────────────────────────────────┐
│               企業登録                │
├─────────────────────────────────────┤
│ 会社名 *                             │
│ [_________________________]         │
│                                   │
│ 担当者名 *                           │
│ [_________________________]         │
│                                   │
│ メールアドレス *                      │
│ [_________________________]         │
│                                   │
│ パスワード *                          │
│ [_________________________]         │
│                                   │
│ 会社概要                             │
│ [_________________________]         │
│ [_________________________]         │
│                                   │
│ 所在地                               │
│ [都道府県を選択 ▼]                   │
│                                   │
│ 抱えている財務課題 *                  │
│ ☐ 資金調達                          │
│ ☐ IPO準備                          │
│ ☐ M&A支援                          │
│ ☐ 管理会計                          │
│ ☐ 財務DX                           │
│ ☐ 事業再生                          │
│                                   │
│ 希望予算（月額）                      │
│ ☐ 〜50万円                          │
│ ☐ 50〜100万円                       │
│ ☐ 100〜200万円                      │
│ ☐ 200万円〜                         │
│ ☐ 応相談                            │
│                                   │
│ [          登録する          ]       │
│                                   │
│ すでにアカウントをお持ちですか？        │
│ [ログインはこちら]                    │
└─────────────────────────────────────┘
```

#### CFO登録フォーム
```
┌─────────────────────────────────────┐
│               CFO登録                │
├─────────────────────────────────────┤
│ お名前 *                             │
│ [_________________________]         │
│                                   │
│ メールアドレス *                      │
│ [_________________________]         │
│                                   │
│ パスワード *                          │
│ [_________________________]         │
│                                   │
│ 自己紹介                             │
│ [_________________________]         │
│ [_________________________]         │
│                                   │
│ 居住地                               │
│ [都道府県を選択 ▼]                   │
│                                   │
│ 専門スキル *                         │
│ ☐ 資金調達支援                       │
│ ☐ IPO・M&A関連                      │
│ ☐ 管理会計構築                       │
│ ☐ 財務DX・システム導入               │
│ ☐ 事業再生・事業承継                  │
│ ☐ 組織・ガバナンス関連               │
│                                   │
│ 経験年数                             │
│ [経験年数を選択 ▼]                   │
│                                   │
│ 希望報酬（月額）                      │
│ ☐ 〜50万円                          │
│ ☐ 50〜100万円                       │
│ ☐ 100〜200万円                      │
│ ☐ 200万円〜                         │
│ ☐ 応相談                            │
│                                   │
│ 稼働形態                             │
│ ☐ リモート可                         │
│ ☐ 出社必要                          │
│ ☐ どちらでも可                       │
│                                   │
│ [          登録する          ]       │
│                                   │
│ すでにアカウントをお持ちですか？        │
│ [ログインはこちら]                    │
└─────────────────────────────────────┘
```

#### バリデーション
- **リアルタイム**: 入力中の基本チェック
- **サーバーサイド**: 送信時の詳細チェック
- **エラー表示**: フィールド下に赤文字で表示

---

### 🔑 ログインページ (`/auth/login`)

#### 画面構成
```
┌─────────────────────────────────────┐
│                ログイン               │
├─────────────────────────────────────┤
│ メールアドレス                        │
│ [_________________________]         │
│                                   │
│ パスワード                            │
│ [_________________________]         │
│                                   │
│ ☐ ログイン状態を保持                  │
│                                   │
│ [          ログイン          ]       │
│                                   │
│ [パスワードを忘れた方はこちら]          │
│                                   │
│ アカウントをお持ちでない方             │
│ [新規登録はこちら]                    │
│                                   │
│ [← ホームに戻る]                     │
└─────────────────────────────────────┘
```

---

### 🏠 メインダッシュボード (`/home`)

#### デスクトップレイアウト
```
┌─────────────────────────────────────┐
│ [RIGHTARM] [検索___] 🔔 👤田中さん ▼ │
├─────────────────────────────────────┤
│ 検索・フィルターエリア                 │
│ ┌─────────────────────────────────┐ │
│ │ キーワード [____________] [検索] │ │
│ │ 地域 [▼東京都] スキル [▼資金調達] │ │
│ │ 報酬 [▼50-100万円]              │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 検索結果                             │
│ ┌───────┬───────┬───────┬───────┐ │
│ │ カード1 │ カード2 │ カード3 │ カード4 │ │
│ └───────┴───────┴───────┴───────┘ │
│ ┌───────┬───────┬───────┬───────┐ │
│ │ カード5 │ カード6 │ カード7 │ カード8 │ │
│ └───────┴───────┴───────┴───────┘ │
│                                   │
│ [さらに読み込む]                      │
└─────────────────────────────────────┘
```

#### モバイルレイアウト
```
┌─────────────────────────────────────┐
│ [RIGHTARM]           🔔 👤 ▼        │
├─────────────────────────────────────┤
│ [🔍 検索・フィルター ▼]              │ ←折りたたみ
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ カード1                         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ カード2                         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ カード3                         │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ [🏠ホーム] [👤プロフィール] [💬メッセージ] │
└─────────────────────────────────────┘
```

#### プロフィールカード（CFO表示例）
```
┌─────────────────────────────────────┐
│ 👤 田中 太郎              ⭐⭐⭐⭐⭐ │
│ 財務コンサルタント | 東京都  (4.8/5.0) │
├─────────────────────────────────────┤
│ 【専門分野】                          │
│ #資金調達 #IPO準備 #管理会計          │
├─────────────────────────────────────┤
│ 【稼働】リモート可 | 経験15年          │
│ 【報酬】月額80-120万円               │
├─────────────────────────────────────┤
│ 大手商社でCFOを経験。IPO支援実績多数。 │
│ 資金調達から上場まで一貫支援が可能。   │
├─────────────────────────────────────┤
│ [詳細を見る] [メッセージを送る]        │
└─────────────────────────────────────┘
```

#### プロフィールカード（企業表示例）
```
┌─────────────────────────────────────┐
│ 🏢 株式会社イノベーション              │
│ SaaS・IT | 東京都 | 従業員30名       │
├─────────────────────────────────────┤
│ 【課題】IPO準備・資金調達              │
│ 【予算】月額100-150万円               │
├─────────────────────────────────────┤
│ 【稼働】週2-3日 | リモート可           │
├─────────────────────────────────────┤
│ 急成長中のSaaS企業です。来年のIPOに   │
│ 向けて財務体制強化をお願いします。     │
├─────────────────────────────────────┤
│ [詳細を見る] [メッセージを送る]        │
└─────────────────────────────────────┘
```

---

### 👤 プロフィール詳細ページ (`/cfo/[id]`, `/company/[id]`)

#### CFO詳細ページ
```
┌─────────────────────────────────────┐
│ [← 戻る] RIGHTARM           👤 ▼    │
├─────────────────────────────────────┤
│ ┌─────┐ 田中 太郎           ⭐⭐⭐⭐⭐ │
│ │ 👤 │ 財務コンサルタント  (4.8/5.0) │
│ │     │ 東京都 | 経験15年   (23件)   │
│ └─────┘ [メッセージを送る]          │
├─────────────────────────────────────┤
│ 専門スキル                           │
│ ┌─────────────────────────────────┐ │
│ │ ✓ 資金調達支援                   │ │
│ │ ✓ IPO・M&A関連                  │ │
│ │ ✓ 管理会計構築                   │ │
│ │ ✓ 財務DX・システム導入           │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 自己紹介                             │
│ ┌─────────────────────────────────┐ │
│ │ 大手商社でCFOとして5年間勤務。     │ │
│ │ IPO支援実績は10社以上。           │ │
│ │ 特に資金調達から上場準備まで       │ │
│ │ 一貫したサポートが得意です。       │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 稼働条件                             │
│ ┌─────────────────────────────────┐ │
│ │ 稼働形態: リモート可              │ │
│ │ 希望報酬: 月額80-120万円          │ │
│ │ 対応地域: 東京都・神奈川県         │ │
│ │ 決済ステータス: 🟢 対応可能       │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ レビュー・評価 (23件)                 │
│ ┌─────────────────────────────────┐ │
│ │ ⭐⭐⭐⭐⭐ 株式会社A              │ │
│ │ "IPO準備で大変お世話になりました" │ │
│ │ 2024/11/15                       │ │
│ ├─────────────────────────────────┤ │
│ │ ⭐⭐⭐⭐☆ 株式会社B              │ │
│ │ "資金調達がスムーズに進みました"   │ │
│ │ 2024/10/28                       │ │
│ └─────────────────────────────────┘ │
│ [すべてのレビューを見る]              │
├─────────────────────────────────────┤
│ [メッセージを送る] [レビューを書く]    │
└─────────────────────────────────────┘
```

---

### 💬 メッセージングページ (`/messages`)

#### デスクトップレイアウト
```
┌─────────────────────────────────────┐
│ [RIGHTARM]                   👤 ▼   │
├─────────────────┬───────────────────┤
│ 会話一覧         │ 田中太郎さんとの会話  │
│ ┌─────────────┐ │ ┌─────────────────┐ │
│ │ 👤 田中太郎   │ │ │ 田中: お疲れ様です │ │
│ │ こんにちは... │ │ │ 10:30            │ │
│ │ 3分前 🔴    │ │ ├─────────────────┤ │
│ └─────────────┘ │ │ あなた: よろしく   │ │
│ ┌─────────────┐ │ │ お願いします      │ │
│ │ 🏢 B社       │ │ │ 10:32            │ │
│ │ 条件について... │ │ ├─────────────────┤ │
│ │ 1時間前      │ │ │ 田中: IPOの件で   │ │
│ └─────────────┘ │ │ ご相談があります   │ │
│                 │ │ 10:35            │ │
│                 │ ├─────────────────┤ │
│                 │ │ [メッセージ入力___]│ │
│                 │ │ [送信]           │ │
│                 │ └─────────────────┘ │
└─────────────────┴───────────────────┘
```

#### モバイルレイアウト（会話一覧）
```
┌─────────────────────────────────────┐
│ [RIGHTARM] メッセージ       👤 ▼     │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 👤 田中太郎              🔴    │ │
│ │ こんにちは、IPOの件で...        │ │
│ │ 3分前                         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 🏢 株式会社イノベーション        │ │
│ │ 条件についてですが...           │ │
│ │ 1時間前                       │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 👤 山田花子                   │ │
│ │ ありがとうございました          │ │
│ │ 昨日                          │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ [🏠ホーム] [👤プロフィール] [💬メッセージ] │
└─────────────────────────────────────┘
```

#### モバイルレイアウト（個別チャット）
```
┌─────────────────────────────────────┐
│ [←] 田中太郎                 👤 ▼   │
├─────────────────────────────────────┤
│                                   │
│ 田中: お疲れ様です                   │ │
│ 10:30                             │ │
│                                   │
│           あなた: よろしく          │ │
│           お願いします  10:32       │ │
│                                   │
│ 田中: IPOの件でご相談があります       │ │
│ 10:35                             │ │
│                                   │
├─────────────────────────────────────┤
│ [メッセージを入力_____________] [送信] │
└─────────────────────────────────────┘
```

---

### 🔧 管理画面（決済ステータス管理）(`/admin`)

#### 管理者ダッシュボード
```
┌─────────────────────────────────────┐
│ [RIGHTARM] 管理画面          👤管理者 │
├─────────────────────────────────────┤
│ 決済ステータス管理                    │
│ ┌─────────────────────────────────┐ │
│ │ 検索: [CFO名/企業名______] [🔍] │ │
│ │ ステータス: [全て▼] 期間: [今月▼] │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 🏢 株式会社A ↔ 👤田中CFO        │ │
│ │ プロジェクト: IPO準備支援         │ │
│ │ 金額: ¥1,000,000              │ │
│ │ ステータス: [請求済み ▼]         │ │
│ │ 更新日: 2024/12/15             │ │
│ │ [詳細] [履歴] [ステータス変更]   │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 🏢 株式会社B ↔ 👤山田CFO        │ │
│ │ プロジェクト: 資金調達サポート      │ │
│ │ 金額: ¥800,000                │ │
│ │ ステータス: [契約済み ▼]         │ │
│ │ 更新日: 2024/12/10             │ │
│ │ [詳細] [履歴] [ステータス変更]   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 決済情報・ステータス変更モーダル
```
┌─────────────────────────────────────┐
│ 決済情報・ステータス管理              │
├─────────────────────────────────────┤
│ 案件: IPO準備支援                    │
│ 企業: 株式会社A                      │
│ CFO: 田中太郎                       │
│ 金額: ¥1,000,000                   │
│                                   │
│ 決済方法・リンク:                     │
│ ┌─────────────────────────────────┐ │
│ │ 銀行振込先:                      │ │
│ │ 三菱UFJ銀行 渋谷支店             │ │
│ │ 普通 1234567                    │ │
│ │ 株式会社ライトアーム              │ │
│ │ [振込先をコピー]                 │ │
│ ├─────────────────────────────────┤ │
│ │ PayPay決済:                     │ │
│ │ [QRコード画像]                  │ │
│ │ [QRコードを表示]                │ │
│ ├─────────────────────────────────┤ │
│ │ 決済リンク:                      │ │
│ │ https://pay.example.com/xxx     │ │
│ │ [リンクをコピー] [リンク送信]     │ │
│ └─────────────────────────────────┘ │
│                                   │
│ 現在のステータス: 契約済み             │
│                                   │
│ ステータス変更:                       │
│ ☐ 未契約                            │
│ ☐ 契約済み                          │
│ ☑️ 請求書送付済み                     │
│ ☐ 入金確認済み                       │
│ ☐ 完了                             │
│ ☐ キャンセル                         │
│                                   │
│ 変更理由・メモ:                       │
│ [請求書をメール送信済み______________] │
│                                   │
│ ☑️ 企業・CFOにメール通知             │
│                                   │
│ [キャンセル] [ステータス更新]          │
└─────────────────────────────────────┘
```

### ⚙️ プロフィール編集ページ (`/profile`)

#### 企業プロフィール編集
```
┌─────────────────────────────────────┐
│ [RIGHTARM] プロフィール編集   👤 ▼   │
├─────────────────────────────────────┤
│ [基本情報] [課題・条件]              │
├─────────────────────────────────────┤
│ 基本情報                             │
│ ┌─────────────────────────────────┐ │
│ │ 会社名 *                         │ │
│ │ [株式会社サンプル_______________]  │ │
│ │                                 │ │
│ │ 担当者名 *                       │ │
│ │ [田中太郎_____________________]  │ │
│ │                                 │ │
│ │ 会社概要                         │ │
│ │ [SaaS事業を展開する___________]  │ │
│ │ [スタートアップです____________]  │ │
│ │                                 │ │
│ │ 所在地                           │ │
│ │ [東京都 ▼]                      │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ [          更新する          ]       │
└─────────────────────────────────────┘
```

---

## データベース設計

### 🗄️ テーブル構造

#### Users テーブル（基本ユーザー情報）
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  user_type VARCHAR(20) NOT NULL CHECK (user_type IN ('company', 'cfo')),
  email_verified BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_login TIMESTAMP WITH TIME ZONE
);
```

#### Company_Profiles テーブル（企業情報）
```sql
CREATE TABLE company_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  company_name VARCHAR(255) NOT NULL,
  contact_person VARCHAR(100) NOT NULL,
  description TEXT,
  location VARCHAR(50), -- 都道府県
  challenges TEXT[], -- 財務課題配列
  budget_range VARCHAR(50), -- 予算レンジ
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### CFO_Profiles テーブル（CFO情報）
```sql
CREATE TABLE cfo_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL,
  bio TEXT,
  location VARCHAR(50), -- 都道府県
  skills TEXT[], -- スキル配列
  experience_years INTEGER,
  rate_range VARCHAR(50), -- 報酬レンジ
  work_style VARCHAR(50), -- 稼働形態
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### Conversations テーブル（会話管理）
```sql
CREATE TABLE conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user1_id UUID REFERENCES users(id) ON DELETE CASCADE,
  user2_id UUID REFERENCES users(id) ON DELETE CASCADE,
  last_message_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user1_id, user2_id)
);
```

#### Messages テーブル（メッセージ）
```sql
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  conversation_id UUID REFERENCES conversations(id) ON DELETE CASCADE,
  sender_id UUID REFERENCES users(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### Reviews テーブル（レビュー・評価）
```sql
CREATE TABLE reviews (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  reviewer_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reviewee_id UUID REFERENCES users(id) ON DELETE CASCADE,
  project_id UUID, -- 将来的なプロジェクト管理に備えて（v2で使用）
  rating INTEGER CHECK (rating >= 1 AND rating <= 5) NOT NULL,
  comment TEXT,
  is_public BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(reviewer_id, reviewee_id, project_id) -- 同一プロジェクトに対する重複評価防止
);
```

#### Payment_Status テーブル（決済ステータス管理）
```sql
CREATE TABLE payment_status (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  company_id UUID REFERENCES company_profiles(id) ON DELETE CASCADE,
  cfo_id UUID REFERENCES cfo_profiles(id) ON DELETE CASCADE,
  project_title VARCHAR(255), -- プロジェクト・案件名
  amount DECIMAL(10,2), -- 金額
  status payment_status_enum DEFAULT 'not_contracted', -- ステータス
  status_history JSONB DEFAULT '[]', -- ステータス変更履歴
  notes TEXT, -- 管理者メモ
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 決済ステータスのenum型
CREATE TYPE payment_status_enum AS ENUM (
  'not_contracted',     -- 未契約
  'contracted',         -- 契約済み
  'invoice_sent',       -- 請求書送付済み
  'payment_confirmed',  -- 入金確認済み
  'completed',          -- 完了
  'cancelled'           -- キャンセル
);

-- 決済リンク・情報管理テーブル
CREATE TABLE payment_links (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  payment_status_id UUID REFERENCES payment_status(id) ON DELETE CASCADE,
  bank_info JSONB, -- 銀行振込情報
  qr_code_url VARCHAR(255), -- QRコード画像URL
  payment_link VARCHAR(255), -- 外部決済サービスリンク
  notes TEXT, -- 決済に関するメモ
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 🔗 インデックス設計
```sql
-- パフォーマンス最適化
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_user_type ON users(user_type);
CREATE INDEX idx_company_profiles_user_id ON company_profiles(user_id);
CREATE INDEX idx_cfo_profiles_user_id ON cfo_profiles(user_id);
CREATE INDEX idx_conversations_users ON conversations(user1_id, user2_id);
CREATE INDEX idx_messages_conversation_id ON messages(conversation_id);
CREATE INDEX idx_messages_created_at ON messages(created_at);
CREATE INDEX idx_reviews_reviewee_id ON reviews(reviewee_id);
CREATE INDEX idx_reviews_reviewer_id ON reviews(reviewer_id);
CREATE INDEX idx_payment_status_company_id ON payment_status(company_id);
CREATE INDEX idx_payment_status_cfo_id ON payment_status(cfo_id);
CREATE INDEX idx_payment_status_status ON payment_status(status);
CREATE INDEX idx_payment_links_payment_status_id ON payment_links(payment_status_id);

-- 全文検索対応
CREATE INDEX idx_company_profiles_search ON company_profiles 
  USING gin(to_tsvector('japanese', company_name || ' ' || description));
CREATE INDEX idx_cfo_profiles_search ON cfo_profiles 
  USING gin(to_tsvector('japanese', name || ' ' || bio));
```

---

## API仕様

### 🔌 RESTful API エンドポイント

#### 認証関連
```typescript
POST   /api/auth/register     // ユーザー登録
POST   /api/auth/login        // ログイン
POST   /api/auth/logout       // ログアウト
POST   /api/auth/verify-email // メール認証
POST   /api/auth/reset-password // パスワードリセット
```

#### プロフィール管理
```typescript
GET    /api/profile           // プロフィール取得
PUT    /api/profile           // プロフィール更新
GET    /api/profile/[id]      // 他ユーザープロフィール取得
```

#### 検索・一覧
```typescript
GET    /api/search            // 検索（クエリパラメータ）
  // ?type=cfo|company
  // &keyword=keyword
  // &location=location
  // &skills=skill1,skill2
  // &budget=range
  // &page=1&limit=20
```

#### メッセージング
```typescript
GET    /api/conversations     // 会話一覧取得
POST   /api/conversations     // 新規会話開始
GET    /api/conversations/[id]/messages // メッセージ一覧
POST   /api/conversations/[id]/messages // メッセージ送信
```

#### レビュー・評価
```typescript
GET    /api/reviews/[userId]  // ユーザーのレビュー一覧取得
POST   /api/reviews           // レビュー投稿
PUT    /api/reviews/[id]      // レビュー編集
DELETE /api/reviews/[id]      // レビュー削除
GET    /api/reviews/stats/[userId] // 評価統計取得
```

#### 決済ステータス・リンク管理
```typescript
// 一般ユーザー用
GET    /api/payment-status    // 自分の決済ステータス一覧取得
GET    /api/payment-status/[id] // 決済ステータス詳細取得
GET    /api/payment-links/[statusId] // 決済リンク・情報取得

// 管理者用
GET    /api/admin/payment-status // 全決済ステータス一覧
POST   /api/admin/payment-status // 決済ステータス作成
PUT    /api/admin/payment-status/[id] // ステータス更新
GET    /api/admin/payment-status/history/[id] // ステータス変更履歴
POST   /api/admin/payment-links // 決済リンク・情報作成
PUT    /api/admin/payment-links/[id] // 決済情報更新
```

### 📡 リクエスト・レスポンス例

#### ユーザー登録
```typescript
// POST /api/auth/register
{
  "email": "tanaka@example.com",
  "password": "password123",
  "user_type": "cfo",
  "profile": {
    "name": "田中太郎",
    "bio": "大手商社でCFO経験",
    "location": "東京都",
    "skills": ["資金調達支援", "IPO・M&A関連"],
    "experience_years": 15,
    "rate_range": "80-120万円",
    "work_style": "リモート可"
  }
}

// Response
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "tanaka@example.com",
    "user_type": "cfo"
  },
  "message": "登録完了。認証メールを送信しました。"
}
```

#### 検索API
```typescript
// GET /api/search?type=cfo&keyword=IPO&location=東京都
{
  "results": [
    {
      "id": "uuid",
      "name": "田中太郎",
      "bio": "大手商社でCFO経験...",
      "location": "東京都",
      "skills": ["資金調達支援", "IPO・M&A関連"],
      "rate_range": "80-120万円",
      "work_style": "リモート可"
    }
  ],
  "total": 25,
  "page": 1,
  "limit": 20
}
```

---

## 技術仕様

### 🛠️ 技術スタック

#### フロントエンド
```
├── Next.js 15.3.4 (App Router)
├── TypeScript 5.x
├── Tailwind CSS 3.x
├── React Hook Form 7.x
├── Zod (バリデーション)
└── React Query / SWR (データフェッチング)
```

#### バックエンド
```
├── Next.js API Routes
├── Supabase
│   ├── PostgreSQL (データベース)
│   ├── Auth (認証)
│   ├── Storage (ファイルストレージ)
│   └── Realtime (リアルタイム通信)
└── SendGrid / Resend (メール送信)
```

#### インフラ・デプロイ
```
├── Vercel (ホスティング)
├── Supabase (BaaS)
├── GitHub (ソースコード管理)
└── GitHub Actions (CI/CD)
```

### 🔧 開発環境

#### 必要なツール
```bash
# Node.js 18.0.0+
node --version

# pnpm (推奨)
npm install -g pnpm

# 環境変数設定
cp .env.example .env.local
```

#### 環境変数
```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
SENDGRID_API_KEY=your_sendgrid_api_key
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=http://localhost:3000
```

#### 開発コマンド
```bash
# 依存関係インストール
pnpm install

# 開発サーバー起動
pnpm dev

# ビルド
pnpm build

# 型チェック
pnpm type-check

# リント
pnpm lint
```

### 📱 レスポンシブ対応

#### ブレークポイント
```css
/* Tailwind CSS ブレークポイント */
sm: 640px   /* モバイル横向き */
md: 768px   /* タブレット */
lg: 1024px  /* デスクトップ */
xl: 1280px  /* 大画面 */
```

#### モバイル最適化
- **タッチターゲット**: 最小44px
- **フォントサイズ**: 最小16px（ズーム防止）
- **レイアウト**: Flexbox/Grid対応
- **画像**: Next.js Image最適化

---

## 開発計画

### 🚀 開発スケジュール（12週間）

#### Phase 1: 基盤構築（Week 1-3）
```
Week 1: プロジェクトセットアップ
├── Next.js プロジェクト作成
├── Supabase 設定
├── 基本認証システム
└── データベース設計・構築

Week 2: 認証・ユーザー管理
├── ユーザー登録・ログイン
├── メール認証
├── パスワードリセット
└── 基本バリデーション

Week 3: プロフィール機能
├── プロフィール作成・編集
├── 企業・CFO別フォーム
├── 画像アップロード（基本）
└── データ保存・取得
```

#### Phase 2: コア機能（Week 4-8）
```
Week 4-5: 検索・一覧機能
├── 検索API実装
├── フィルタリング機能
├── ページネーション
└── 検索結果表示

Week 6-7: プロフィール詳細
├── 詳細ページ実装
├── レスポンシブ対応
├── SEO対策
└── パフォーマンス最適化

Week 8: メッセージング基盤
├── 会話作成・管理
├── メッセージ送受信API
├── リアルタイム更新
└── 基本UI実装
```

#### Phase 3: 仕上げ（Week 9-12）
```
Week 9-10: メッセージング完成
├── チャットUI完成
├── メール通知
├── モバイル対応
└── パフォーマンス最適化

Week 11: 統合・テスト
├── 機能統合テスト
├── ユーザビリティテスト
├── パフォーマンステスト
└── バグ修正

Week 12: デプロイ・運用準備
├── 本番環境構築
├── ドメイン設定
├── 監視設定
└── ローンチ準備
```

### 👥 チーム構成

#### 必要人員
```
フルスタック開発者: 2名
├── リード開発者 (1名)
└── サブ開発者 (1名)

UI/UXデザイナー: 1名 (パートタイム)
プロジェクトマネージャー: 1名 (パートタイム)
```

#### 役割分担
```
リード開発者:
├── アーキテクチャ設計
├── バックエンドAPI
├── インフラ・デプロイ
└── コードレビュー

サブ開発者:
├── フロントエンド実装
├── UI/UXコンポーネント
├── レスポンシブ対応
└── テスト実装

デザイナー:
├── UI/UXデザイン
├── プロトタイプ作成
├── デザインシステム
└── ユーザビリティ改善

PM:
├── プロジェクト管理
├── 要件調整
├── 品質管理
└── ステークホルダー調整
```

### 💰 開発コスト見積もり

#### 人件費（3ヶ月）
```
リード開発者: ¥800,000/月 × 3ヶ月 = ¥2,400,000
サブ開発者: ¥600,000/月 × 3ヶ月 = ¥1,800,000
デザイナー: ¥400,000/月 × 1.5ヶ月 = ¥600,000
PM: ¥300,000/月 × 1.5ヶ月 = ¥450,000

小計: ¥5,250,000
```

#### インフラ・ツール費用
```
Supabase Pro: $25/月 × 3ヶ月 = $75
Vercel Pro: $20/月 × 3ヶ月 = $60
SendGrid: $15/月 × 3ヶ月 = $45
ドメイン・SSL: $50/年 = $50
監視ツール: $30/月 × 3ヶ月 = $90

小計: $320 (¥48,000)
```

#### 総開発コスト
```
人件費: ¥5,250,000
インフラ費: ¥48,000
予備費(10%): ¥530,000

総計: ¥5,828,000
```

---

## 運用・保守

### 📊 監視・分析

#### KPI設定
```
ユーザー関連:
├── 新規登録数 (目標: 月20名)
├── アクティブユーザー数 (目標: 月60名)
├── ユーザー継続率 (目標: 30%以上)
└── プロフィール完成率 (目標: 80%以上)

マッチング関連:
├── メッセージ送信数 (目標: 月100件)
├── 会話成立率 (目標: 50%以上)
├── 面談実施率 (目標: 20%以上)
└── 契約成立率 (目標: 10%以上)

技術関連:
├── ページ表示速度 (目標: 3秒以内)
├── エラー率 (目標: 1%以下)
├── 稼働率 (目標: 99%以上)
└── セキュリティインシデント (目標: 0件)
```

#### 分析ツール
```
Google Analytics 4: ユーザー行動分析
Supabase Analytics: データベース分析
Vercel Analytics: パフォーマンス分析
Hotjar: ユーザビリティ分析
```

### 🔧 保守・運用

#### 日次運用
```
├── システム稼働状況確認
├── エラーログチェック
├── ユーザー問い合わせ対応
└── データバックアップ確認
```

#### 週次運用
```
├── KPI数値レポート
├── ユーザーフィードバック分析
├── パフォーマンス改善検討
└── セキュリティアップデート
```

#### 月次運用
```
├── 月次レポート作成
├── ユーザーインタビュー実施
├── 機能改善計画策定
└── システムアップデート
```

### 🛡️ セキュリティ

#### セキュリティ対策
```
認証・認可:
├── JWT トークンによる認証
├── パスワードハッシュ化 (bcrypt)
├── セッション管理
└── 権限ベースアクセス制御

通信セキュリティ:
├── HTTPS 通信 (TLS 1.3)
├── CORS 設定
├── CSP (Content Security Policy)
└── レート制限

データ保護:
├── 個人情報暗号化
├── データベース暗号化
├── バックアップ暗号化
└── GDPR 準拠
```

#### セキュリティ監査
```
月次:
├── 脆弱性スキャン
├── ペネトレーションテスト
├── セキュリティログ監査
└── インシデント対応訓練

四半期:
├── セキュリティポリシー見直し
├── 外部セキュリティ監査
├── コンプライアンスチェック
└── 従業員セキュリティ教育
```

### 📈 スケーリング計画

#### v2 機能拡張（+3ヶ月）
```
追加機能:
├── スカウト・応募システム
├── 面談予約・カレンダー連携
├── 基本的な評価・レビュー
├── 通知システム強化
└── 詳細な検索フィルター

技術改善:
├── パフォーマンス最適化
├── リアルタイム機能強化
├── モバイルアプリ検討
└── AI レコメンデーション
```

#### v3 本格展開（+6ヶ月）
```
ビジネス機能:
├── 決済・請求システム
├── 契約管理システム
├── 詳細な分析・レポート
├── 管理者ダッシュボード
└── API エコシステム

スケーリング:
├── マイクロサービス化
├── CDN 導入
├── 負荷分散
├── データベース最適化
└── 24/7 監視体制
```

---

## 付録

### 📚 参考資料

#### 競合分析
- **クラウドワークス**: UI/UX参考
- **ランサーズ**: マッチング機能参考
- **ビザスク**: 専門家マッチング参考
- **LinkedIn**: プロフィール機能参考

#### 技術参考
- **Next.js 公式ドキュメント**: https://nextjs.org/docs
- **Supabase 公式ドキュメント**: https://supabase.com/docs
- **Tailwind CSS**: https://tailwindcss.com/docs
- **React Hook Form**: https://react-hook-form.com/

### 🔍 用語集

| 用語 | 説明 |
|------|------|
| CFO | Chief Financial Officer（最高財務責任者） |
| MVP | Minimum Viable Product（最小実行可能製品） |
| BaaS | Backend as a Service |
| PWA | Progressive Web Application |
| SSR | Server-Side Rendering |
| CSR | Client-Side Rendering |
| API | Application Programming Interface |
| CRUD | Create, Read, Update, Delete |

### 📞 連絡先・サポート

#### 開発チーム
- **プロジェクトマネージャー**: [PM連絡先]
- **リード開発者**: [開発者連絡先]
- **デザイナー**: [デザイナー連絡先]

#### 緊急連絡先
- **システム障害**: [緊急連絡先]
- **セキュリティインシデント**: [セキュリティ連絡先]

---

**作成日**: 2024年12月22日  
**バージョン**: v4-Simple 1.0  
**最終更新**: 2024年12月22日  
**承認者**: [承認者名]  

*本要件定義書は RIGHTARM v4-Simple の開発・運用における公式な指針文書です。変更時は関係者全員の合意を必要とします。*